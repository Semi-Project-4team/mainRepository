<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>동물병원플러스입니다.</title>
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/header.css">
    <link rel="stylesheet" href="/css/footer.css">
</head>
<body>

<div th:insert="~{common/header.html}"></div> <!-- 헤더 포함 -->

    <!--공지사항-->
<div class="main">
    <div class="search-wrap">


<div class="notice">
    <h3>
        <a id="noticeList" href="/notice/list">[공지사항] </a>
        <a id="noticeLink" class="noticeLink" th:attr="data-code=${noticeList[0].code}" th:text="${noticeList[0].name}"></a>
    </h3>
</div>

<!-- Thymeleaf에서 JSON으로 변환된 noticeList를 JavaScript에 전달 -->

<script th:inline="javascript">
    // noticeList를 JSON 배열로 변환하여 JavaScript로 전달
    const noticeList = /*[[${noticeList}]]*/ [];

    const noticeLinks = [];

    // 공지사항 목록을 배열에 저장
    noticeList.forEach((notice) => {
        noticeLinks.push({
            code: notice.code,  // 공지사항 코드
            text: notice.name   // 공지사항 이름
        });
    });

    let currentIndex = 0;

    // 처음 제목을 즉시 표시
    mainNotice();

    // 공지사항을 5초마다 변경
    const intervalId = setInterval(() => {
        currentIndex = (currentIndex + 1) % noticeLinks.length; // 인덱스 증가 및 순환
        mainNotice();
    }, 5000);

    function mainNotice() {
        // 현재 인덱스에 해당하는 공지사항 정보를 가져옴
        const notice = noticeLinks[currentIndex];

        // 링크 텍스트와 href를 업데이트
        document.getElementById('noticeLink').textContent = notice.text; // 제목 변경
        document.getElementById('noticeLink').href = `/notice/detail/${notice.code}`; // 링크 변경

    }
</script>


    <!--병원찾기-->
    <div class="search-hospital">
        <br>
<!--        <button class="button" onclick="location.href='/hospital/sidoAll'">지역별 동물병원찾기</button>-->
        <button class="button" onclick="openPopup()">지역별 동물병원찾기</button>
        <br>
        <br>
        <button class="button" onclick="location.href='/hospital/info/list'">동물병원 전체목록</button>
        <script>
            function openPopup() {
                window.open('hospital/sidoAll', 'hospital/info/sigungu/', 'width=600,height=400,scrollbars=yes');
            }
        </script>
        <br>
        <br>
        <form action="/hospital/search" method="GET">
            <input type="text" id="query" name="query" placeholder="지역 또는 병원이름을 직접 검색">
            <button type="submit">검색</button>
        </form>
        <br>
        <br>


        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="close" style="cursor: pointer;">&times;</span>
                <h2>병원 찾기</h2>
                <select id="sido" name="sido">
<!--                    <option value="0"> 시/도 </option>-->
                    <!-- 시/도 목록은 서버에서 동적으로 생성 -->
                </select>
<!--                <select id="sido" onchange="loadSigungu(this.value)">-->
<!--                    <option value="0"> 시/도 </option>-->
<!--                    &lt;!&ndash; 시/도 목록은 서버에서 동적으로 생성 &ndash;&gt;-->
<!--                </select>-->
                <select id="sigungu" onchange="loadEupMyeonDong(this.value)" disabled>
                    <option value=""> 시/군/구 </option>
                </select>
                <select id="eupmyeondong" disabled>
                    <option value=""> 읍/면/동 </option>
                </select>
                <button onclick="updateLabel()">선택</button>
            </div>
        </div>

    </div>
    </div>
</div>

<div th:insert="~{common/footer.html}"></div> <!-- 푸터 포함 -->


    <script>
        // fetch("/hospital/sidoAll")
        //     .then(res => res.json())
        //     .then(data => {
        //         const sidoName = document.getElementById('searchHospitalBtn');
        //
        //         for (let index in data) {
        //             // 새로운 <option> 요소를 생성
        //             const $option = document.createElement('option');
        //             // <option> 요소의 값을 카테고리 코드로 설정
        //             // $option.value = data[index].petName;
        //             // <option> 요소의 텍스트를 카테고리 이름으로 설정
        //             $option.textContent = data[index].name;
        //             // <option> 요소를 categoryCode <select> 요소에 추가
        //             petName.appendChild($option);
        //         }
        //     });
        document.getElementById("searchHospitalBtn").onclick = function() {
            document.getElementById("myModal").style.display = "flex";
        }

        document.getElementsByClassName("close")[0].onclick = function() {
            document.getElementById("myModal").style.display = "none";
        }

        window.onclick = function(event) {
            if (event.target == document.getElementById("myModal")) {
                document.getElementById("myModal").style.display = "none";
            }
        }

        // function loadSido() {
            fetch("/hospital/sidoList")
                .then(res => res.json())
                .then(data => {
                    const sidoSelect = document.getElementById("sido");

                    // 각 카테고리 데이터를 순회
                    for (let index in data) {
                        const $option = document.createElement('option');
                        // $option.value = data[index].petName;
                        $option.textContent = data[index].name;
                        sidoSelect.appendChild($option);
                    }
                });
        // }

        function loadSigungu(sidoCode) {
            if (sidoCode) {
                fetch(`/hospital/sidoAll`)
                    .then(response => response.json())
                    .then(data => {
                        const sigunguSelect = document.getElementById("sigungu");
                        sigunguSelect.innerHTML = '<option value="">-- 시/군/구 선택 --</option>';
                        data.forEach(sigungu => {
                            const option = document.createElement("option");
                            // option.value = sigungu.sigunguCode;
                            option.textContent = sigungu.name;
                            sigunguSelect.appendChild(option);
                        });
                        sigunguSelect.disabled = false;
                    });
            } else {
                document.getElementById("sigungu").disabled = true;
                document.getElementById("eupmyeondong").disabled = true;
            }
        }

        function loadEupMyeonDong(sigunguCode) {
            if (sigunguCode) {
                fetch(`/api/eupmyeondong/${sigunguCode}`)
                    .then(response => response.json())
                    .then(data => {
                        const eupmyeondongSelect = document.getElementById("eupmyeondong");
                        eupmyeondongSelect.innerHTML = '<option value="">-- 읍/면/동 선택 --</option>';
                        data.forEach(eupmyeondong => {
                            const option = document.createElement("option");
                            option.value = eupmyeondong.eupmyeondongCode;
                            option.textContent = eupmyeondong.eupmyeondongName;
                            eupmyeondongSelect.appendChild(option);
                        });
                        eupmyeondongSelect.disabled = false;
                    });
            } else {
                document.getElementById("eupmyeondong").disabled = true;
            }
        }

        function updateLabel() {
            const sidoName = document.getElementById("sido").selectedOptions[0].text;
            const sigunguName = document.getElementById("sigungu").selectedOptions[0]?.text || '';
            const eupmyeondongName = document.getElementById("eupmyeondong").selectedOptions[0]?.text || '';

            const selectedRegionLabel = `${sidoName} > ${sigunguName} > ${eupmyeondongName}`;
            document.getElementById("selectedRegion").textContent = selectedRegionLabel;

            // 병원 찾기 로직을 추가할 수 있습니다.
            // findHospitals();
        }
    </script>
</div>
</body>
</html>